<!-- user/templates/answer2.html -->

{% extends 'layout/base.html' %}

{% block title %}
Домашняя страница
{% endblock %}

{% block content %}
<div class="container" id="form">
    <h3 class="text-center display-8">РАЗРАБОТКА РАСЧЕТНОЙ СРЕДЫ ПОКАЗАТЕЛЕЙ ПЕРЕНОСА ВЕЩЕСТВ</h3>
    <form id="parametersForm" class="mt-5" method="get">

        <input type="text" name="options" value="{{ item_id }}" hidden>
        {% for x, y in description.items %}
        <div class="form-group row mt-2">
            <label for="{{ x }}" class="col-sm-6 col-form-label">{{ y.name }} ({{ x }}):</label>
            <div class="col-sm-6">
                {% if y.value|length > 1 %}
                <input type="number" class="form-control" id="{{ x }}" name="{{ x }}" value="{{ y.value.0 }}"
                    min="{{ y.value.0 }}" max="{{ y.value.1 }}" required>
                {% else %}
                <input type="number" class="form-control" id="{{ x }}" name="{{ x }}" value="{{ y.value }}" required>
                {% endif %}
            </div>
        </div>
        {% endfor %}
        <div class="d-flex justify-content-between mt-5">
            <button type="button" onclick="submitData()" class="btn btn-primary">РЕШЕНИЕ</button>
            <a href="/" class="btn btn-secondary">ГЛАВНАЯ</a>
            <a href="/selects/" class="btn btn-success">ВЫХОД</a>
            <!-- Ensure href attribute ends with a trailing slash if APPEND_SLASH=True -->
        </div>
    </form>
</div>

<div class="loader">
    <div id="loader" class="d-flex justify-content-center align-items-center" style="height: 100vh;display: none;">
        <div class="h1Container">

            <div class="cube h1 w1 l1">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h1 w1 l2">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h1 w1 l3">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h1 w2 l1">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h1 w2 l2">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h1 w2 l3">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h1 w3 l1">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h1 w3 l2">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h1 w3 l3">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>
        </div>

        <div class="h2Container">

            <div class="cube h2 w1 l1">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h2 w1 l2">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h2 w1 l3">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h2 w2 l1">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h2 w2 l2">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h2 w2 l3">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h2 w3 l1">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h2 w3 l2">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h2 w3 l3">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>
        </div>

        <div class="h3Container">

            <div class="cube h3 w1 l1">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h3 w1 l2">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h3 w1 l3">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h3 w2 l1">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h3 w2 l2">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h3 w2 l3">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h3 w3 l1">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h3 w3 l2">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>

            <div class="cube h3 w3 l3">
                <div class="face top"></div>
                <div class="face left"></div>
                <div class="face right"></div>
            </div>
        </div>
    </div>
</div>
<div id="content">
    <div class="row m-2">
        <div class="col-md-6">
            <div class="card">
                <h3 class="card-header">Cm ning X koordinata bo'yicha taqsimoti</h3>
                <div class="card-body">
                    <canvas id="distributionChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <h3 class="card-header">Cim ning X koordinata bo'yicha taqsimoti</h3>
                <div class="card-body">
                    <canvas id="dynamicChart"></canvas>
                </div>
            </div>
        </div>
        <hr class="m-1">
        <div class="col-md-6">
            <div class="card">
                <h3 class="card-header">Cm ning vaqt bo'yicha dinamikasi</h3>
                <div class="card-body">
                    <canvas id="exportChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $("#content").hide();
    $(".loader").hide();

    function submitData() {
        const data = $("#parametersForm").serialize();


        $(".loader").show();
        $("#form").hide();
        
        $.ajax({
            url: "/result/",
            type: "POST",
            data: data,
            success: function (data) {
                createChart(data)

                document.getElementById('loader').classList.add('hide-important');
                $("#content").show();
            }
        });
    }


    function createChart(data) {
        const x = data.x;
        const y = data.y;
        const C = data.C;
        const tmax = y.length - 1;

        const distributionCtx = document.getElementById('distributionChart').getContext('2d');
        new Chart(distributionCtx, {
            type: 'line',
            data: {
                labels: x,
                datasets: [{
                        label: `C(t = ${tmax} s)`,
                        data: C[tmax],
                        borderColor: 'red',
                        fill: false,
                        tension: 0.1
                    },
                    {
                        label: `C(t = ${2*tmax/3} s)`,
                        data: C[2 * tmax / 3],
                        borderColor: 'blue',
                        fill: false,
                        tension: 0.1
                    },
                    {
                        label: `C(t = ${tmax/3} s)`,
                        data: C[tmax / 3],
                        borderColor: 'green',
                        fill: false,
                        tension: 0.1
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'X koordinata (m)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Kontsentratsiya (m^3/m^3)'
                        }
                    }
                }
            }
        });

        // 2. Vaqt bo'yicha dinamik diagramma
        const C2 = data.C2;
        const C3 = data.C3;
        const C4 = data.C4;

        const dynamicCtx = document.getElementById('dynamicChart').getContext('2d');
        new Chart(dynamicCtx, {
            type: 'line',
            data: {
                labels: y,
                datasets: [{
                        label: 'C (x = 0.1 m)',
                        data: C2,
                        borderColor: 'purple',
                        fill: false,
                        tension: 0.1
                    },
                    {
                        label: 'C (x = 0.3 m)',
                        data: C3,
                        borderColor: 'orange',
                        fill: false,
                        tension: 0.1
                    },
                    {
                        label: 'C (x = 0.5 m)',
                        data: C4,
                        borderColor: 'brown',
                        fill: false,
                        tension: 0.1
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Vaqt (s)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Kontsentratsiya (m^3/m^3)'
                        }
                    }
                }
            }
        });

        // 3. Oxirgi ustunni eksport qilish diagrammasi
        const lastColumnData = C.map(row => row[row.length - 1]);

        const exportCtx = document.getElementById('exportChart').getContext('2d');
        new Chart(exportCtx, {
            type: 'bar',
            data: {
                labels: y,
                datasets: [{
                    label: 'Oxirgi ustun (tmax)',
                    data: lastColumnData,
                    backgroundColor: 'rgba(0, 123, 255, 0.5)',
                    borderColor: 'rgba(0, 123, 255, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Vaqt (s)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Kontsentratsiya (m^3/m^3)'
                        }
                    }
                }
            }
        });
    }
</script>
{% endblock %}